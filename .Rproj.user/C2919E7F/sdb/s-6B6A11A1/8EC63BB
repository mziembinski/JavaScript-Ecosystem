{
    "collab_server" : "",
    "contents" : "packages<-c(\"data.table\",\"ggplot2\",\"jsonlite\",\"curl\",\"httr\",\"stringr\",\"scales\",\n            \"ghql\",\"graphql\",\"XML\",\"plotly\",\"knitr\",\"RColorBrewer\")\n\n#lapply(packages, install.packages)\n\nlapply(c(\"plotly\"), install.packages)\n#devtools::install_github(\"schloerke/gqlr\")\n\ndevtools::install_github(\"ropensci/ghql\")\n\nsapply(packages, require,character.only = TRUE)\n\nlibrary(XML)\nlibrary(plotly)\n\n#### github graphql connection ####\n# https://github.com/ropensci/ghql\n\ntoken <- \"f51147b8197d7d9d9421bf992a2dfbc758197ae9\"\ncli <- GraphqlClient$new(\n  url = \"https://api.github.com/graphql\",\n  headers = add_headers(Authorization = paste0(\"Bearer \", token))\n)\n\n#### github queries #### \n# https://developer.github.com/v4/explorer/\n\nsource('download_graphql.R')\nsource('check_repos.R')\n\ntemp<-download_graphql(\"facebook\",\"react\",100)\ntemp$totalCount\n\nfinalql<-temp$data\n  \n#angular\ntemp<-download_graphql(\"angular\",\"angular\",100) # if no graphql data go to webscrapping\n# node\ntemp<-download_graphql(\"nodejs\",\"node\",100)\n#ember\ntemp<-download_graphql(\"emberjs\",\"ember.js\",100)\ntemp$totalCount # should be more than 200 :/\n\nfinalql<-finalql[name!=\"ember.js\"]\n\n#vue\ntemp<-download_graphql(\"vuejs\",\"vue\",100)\ntemp$totalCount\nfinalql<-rbind(finalql,temp$data)\n\ntemp<-download_graphql(\"vuejs\",\"vue\",100,before=temp$data$cursor[1])\nfinalql<-rbind(finalql,temp$data)\n\n# backbone\ntemp<-download_graphql(\"jashkenas\",\"backbone\",100)\n\n# redux\ntemp<-download_graphql(\"reactjs\",\"redux\",100)\n\ntemp$totalCount\n\nfinalql<-rbind(finalql,temp$data)\n\n# meteor\ntemp<-download_graphql(\"meteor\",\"meteor\",100)\n\n\n# webpack\ntemp<-download_graphql(\"webpack\",\"webpack\",100)\n### should be more :/\n\n# check\nfinalql[,.N,by=owner]\n\n# webscrapping\n## because GraphQL and https://api.github.com/repos/angular/angular/releases gives empty arrays\n\nsource('web_scrap.R')\n\nfinalscp<-web_scrap(\"angular\",\"angular\",100,1)\n\n#nodejs\ntemp<-web_scrap(\"nodejs\",\"node\",100,3)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n#backbone\ntemp<-web_scrap(\"jashkenas\",\"backbone\",100,1)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n#meteor\ntemp<-web_scrap(\"meteor\",\"meteor\",100,3)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n#webpack\ntemp<-web_scrap(\"webpack\",\"webpack\",100,1)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n#ember\ntemp<-web_scrap(\"emberjs\",\"ember.js\",100,2)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n#nodejs\ntemp<-web_scrap(\"facebook\",\"react\",20,1)\ntemp\nfinalscp<-rbind(finalscp,temp)\n\n\n# check\nfinalscp[,.N,by=.(owner,name)]\n\n## save\nsave(finalql,finalscp,file=\"data/finals.RData\")\nload(file=\"data/finals.RData\")\n\n#### formatting ####\n\nfinalql\nfinalscp\n\nfinal<-finalscp[,.(owner,name,date,version,version_ext)]\n\nfinalql[,date:=as.Date(publishedAt)]\nfinalql[,id:=.I]\nfinalql[,version:=gsub(paste0(\"https://github.com/\",owner,\"/\",name,\"/releases/tag/\"),\"\",url),by=id]\nfinalql[,version_ext:=str_extract(url,\"\\\\d*\\\\.\\\\d*\\\\.\\\\d*\")]\n\nfinal<-rbind(final,finalql[name!=\"react\"][,.(owner,name,date,version,version_ext)])\n\nwrite.csv(final,file=\"data/final.csv\")\n\n# summary\nfinalsm<-final[,.(date_min=min(date),date_max=max(date),\n                  version_first=min(version),\n                  version_last=max(version)),by=.(owner,name)]\n\nfinal[final[,.(date=min(date)),by=.(owner,name)],on=.(owner,name,date)]\n\n## checked manually with respective guthub pages\n### first\nfinalsm[name==\"angular\",version_first:=\"0.0.1\"]\nfinalsm[name==\"webpack\",version_first:=\"1.0.0\"]\nfinalsm[name==\"node\",version_first:=\"0.0.1\"]\nfinalsm[name==\"meteor\",version_first:=\"0.0.40\"]\nfinalsm[name==\"ember.js\",version_first:=\"0.9\"]\nfinalsm[name==\"react\",version_first:=\"0.3.0\"]\nfinalsm[name==\"vue\",version_first:=\"0.6.0\"]\nfinalsm[name==\"redux\",version_first:=\"0.2.0\"]\n\n### last\nfinal[final[,.(date=max(date)),by=.(owner,name)],on=.(owner,name,date)]\n\nfinalsm\nfinalsm[name==\"angular\",version_last:=\"4.2.0\"]\nfinalsm[name==\"backbone\",version_last:=\"1.3.3\"]\nfinalsm[name==\"webpack\",version_last:=\"3.0.0\"]\nfinalsm[name==\"node\",version_last:=\"8.0.0\"]\nfinalsm[name==\"meteor\",version_last:=\"1.6\"]\nfinalsm[name==\"ember.js\",version_last:=\"2.14.0\"]\nfinalsm[name==\"react\",version_last:=\"15.5.4\"]\nfinalsm[name==\"vue\",version_last:=\"2.3.3\"]\nfinalsm[name==\"redux\",version_last:=\"3.6.0\"]\n\nfinalsm[,.(owner,name,date_min,version_first,date_max,version_last)]\n\nkable(finalsm[,.(owner,name,date_min,version_first,date_max,version_last)])\n\nfinal[,c(\"V1\",\"V2\",\"V3\"):=tstrsplit(version_ext,\"\\\\.\")]\nfinal[,calculated_ver:=as.numeric(V1)*1e6+as.numeric(V2)*1e3+as.numeric(V3)]\n\n#### react ####\n\nfinal[name==\"react\"]\n\nkable(final[name==\"react\"][,.(owner,name,date,version,version_ext)][order(-date)][1:10])\n\nggdata<-final[name==\"react\"]\nggdata[V1==\"15\",major:=\"15\"]\nggdata[V1!=\"15\",major:=V2]\nggdata[,major:=as.numeric(major)]\n\ng<-ggplot(ggdata,aes(date,reorder(version_ext,calculated_ver),color=factor(major)))+\n  geom_point(size=2)+\n  theme_bw()+labs(y=\"versions\",color=\"Major release\",title=\"Releases dates\")+\n  theme(plot.title = element_text(hjust = 0.5))\n\nggsave(g,file=\"images/react2.png\",width=15,height=12,units=\"cm\")\n\ntemp<-ggdata[major!=0][,.(.N,date_first=min(date),date_last=max(date)),\n             by=.(owner,name,major)]\ntemp[,previous:=shift(date_first,1,type=\"lead\")]\ntemp[,since_release:=date_last-date_first]\ntemp[,since_previous:=date_first-previous]\n\nkable(temp)\n\ng<-ggplot(temp,aes(major,since_previous,fill=factor(major)))+\n  geom_bar(stat=\"identity\")+coord_flip()+\n  theme_bw()+labs(x=\"Major release\",y=\"\",\n                  fill=\"Major release\",title=\"Days since first release of previous major\")+\n  theme(plot.title = element_text(hjust = 0.5))\n\nggsave(g,file=\"images/react_since.png\",width=15,height=12,units=\"cm\")\n\n#### nodejs ####\nfinal[name==\"node\"]\n\nkable(final[name==\"node\"][,.(owner,name,date,version,version_ext)][order(-date)][1:10])\n\nggdata<-final[name==\"node\"][!is.na(V1)]\nggdata[,major:=as.numeric(V1)]\n\nggdata$version_ext\n\ng<-ggplot(ggdata,aes(date,reorder(version_ext,calculated_ver),color=factor(major)))+\n  geom_point(size=2)+\n  theme_bw()+labs(y=\"versions\",color=\"Major release\",title=\"Releases dates\")+\n  theme(plot.title = element_text(hjust = 0.5),\n        axis.ticks.y=element_blank(),\n        axis.text.y = element_blank(),\n        panel.grid.major.y=element_blank())\ng\nggsave(g,file=\"images/node.png\",width=15,height=12,units=\"cm\")\n\np <- plot_ly(ggdata, x = ~date, y = ~reorder(version_ext,calculated_ver),\n             color=~factor(major),colors=brewer.pal(9, \"Paired\"),\n             type = 'scatter',mode = 'markers',\n             text = ~paste('(Date,Version)'))%>%\n  layout(xaxis = list(title=\"Date of the release\"), yaxis = list(title=\"Version\"))\np\n\np<-plot_ly(ggdata[!is.na(version_ext)][order(calculated_ver)], x = ~date, y = ~version_ext,\n        color=~factor(major),colors=brewer.pal(9, \"Paired\"),\n        type = 'scatter',mode = 'markers',\n        text = ~paste('Version: ',version))%>%\n  layout(xaxis = list(title=\"Date of the release\"),\n         yaxis = list(title=\"Version\",\n                      tick0=5,\n                      dtick=30,\n                      categoryorder = \"array\",\n                      categoryarray = ~calculated_ver))\n\napi_create(p, filename = \"nodejs_releases\")\n\ntemp<-ggdata[!is.na(major)][,.(.N,date_first=min(date),date_last=max(date)),\n                       by=.(owner,name,major)]\nsetkey(temp,owner,name,major)\ntemp[,previous:=shift(date_first,1,type=\"lag\")]\ntemp[,since_release:=date_last-date_first]\ntemp[,since_previous:=date_first-previous]\n\nkable(temp[order(-major)])\n\ng<-ggplot(temp,aes(major,since_previous,fill=factor(major)))+\n  geom_bar(stat=\"identity\")+coord_flip()+\n  theme_bw()+labs(x=\"Major release\",y=\"\",\n                  fill=\"Major release\",title=\"Days since first release of previous major\")+\n  theme(plot.title = element_text(hjust = 0.5))\n\nggsave(g,file=\"images/node_since.png\",width=15,height=12,units=\"cm\")\n\n#### plotting ####\n\n\n\n## first\nfinal_scp[,c(\"V1\",\"V2\",\"V3\"):=tstrsplit(version,\"\\\\.\")]\n\nfinal_scp[,calculated_ver:=as.numeric(V1)*1e6+as.numeric(V2)*1e3+as.numeric(V3)]\n\n## only first\nsetkey(final_scp,owner,name,calculated_ver)\nfinal_scp[!is.na(version),first:=1]\nfinal_scp[calculated_ver==shift(calculated_ver,1),first:=0]\n\nggplot(final_scp[first==1],aes(date,calculated_ver))+geom_line()+theme_bw()+\n  scale_y_continuous(label=comma,breaks=seq(0,16e6,1e6))\n\nggplot(final_scp[first==1],aes(date,calculated_ver))+geom_line()+geom_point()+\n  theme_bw()+\n  scale_y_continuous(label=comma,breaks=seq(0,16e6,1e6))\n\ng<-ggplot(final_scp[first==1],aes(date,calculated_ver))+geom_line()+geom_point()+\n  facet_grid(V1~.,scale=\"free\")+\n  theme_bw()+\n  scale_y_continuous(label=comma,breaks=seq(0,16e6,1e6))\ng\n\nggplotly(g)\n\n#### extract date and version ####\n\n\nfinal[,c(\"V1\",\"V2\",\"V3\"):=tstrsplit(from_url,\"\\\\.\")]\n\nfinal[name==\"react\"&V1==0,calculated_ver:=as.numeric(V2)*1e6+as.numeric(V3)*1e3]\n\nfinal[name==\"react\"&V1!=0,calculated_ver:=as.numeric(V1)*1e6+as.numeric(V2)*1e3+as.numeric(V3)]\n\n## only first\nsetkey(final,owner,name,calculated_ver)\nfinal[,first:=1]\nfinal[calculated_ver==shift(calculated_ver,1),first:=0]\n\nggplot(final[first==1],aes(date,calculated_ver))+geom_line()+theme_bw()+\n  scale_y_continuous(label=comma,breaks=seq(0,16e6,1e6))\n",
    "created" : 1496480390327.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1045266090",
    "id" : "8EC63BB",
    "lastKnownWriteTime" : 1497014026,
    "last_content_update" : 1497021226173,
    "path" : "C:/Users/Michal/Dropbox/!!!_blog/JavaScript_trends/github_releases.R",
    "project_path" : "github_releases.R",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}